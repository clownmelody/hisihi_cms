<link rel="stylesheet" type="text/css" href="{:getRootUrl()}Addons/Advice/Css/Advice.css">
<if condition="is_login()">
<div id='advice' class='common_block_border pb20 advice quick_send_box'>
  <a type="button" class="open-popup-link" data-even="jianyi" href="#frm_post_weibo_popup"><img width='230px' src="{:getRootUrl()}Addons/Advice//images/proposal.png" alt="欢迎给我们提建议"  class="mb10"/></a>
  <a type="button" class="open-popup-link" data-even="bug" href="#frm_post_weibo_popup"><img width='230px' src="{:getRootUrl()}Addons/Advice//images/feedback-bug.png" alt="给我们反馈Bug" /></a>
  
  <div id="frm_post_weibo_popup" class="white-popup mfp-hide weibo_post_box" style="max-width: 745px">
      <h2 id="weibo_title"></h2>
      <div class="row">
          <div class="col-xs-12">
              <div class="pull-right show_num" style="margin-bottom: 10px">还可以输入{:C('WEIBO_WORDS_COUNT')}个字</div>
              <p><textarea class="form-control" id="weibo_content" style="height: 6em;" onfocus="startCheckNum($(this))" onblur="endCheckNum()"></textarea></p>
              <a href="javascript:" onclick="insertFace($(this))"><img src="__STATIC__/image/bq.png"/>表情</a>
              <p class="pull-right"><input type="submit" value="发表 Ctrl+Enter" class="btn btn-primary send_weibo_button" data-url="{:U('Weibo/Index/doSend')}"/></p>
          </div>
      </div>
      <div id="emot_content" class="emot_content"></div>
      <div id="hook_show" class="emot_content"></div>
  </div>  
  <script>
      var ID_setInterval;
      function checkNum(obj){
          var value=obj.val();
          var value_length=value.length;
          var can_in_num=initNum-value_length;
          if(can_in_num<0){
              value=value.substr(0,initNum);
              obj.val(value);
              can_in_num=0;
          }
          var html="还可以输入"+can_in_num+"个字";
          $('.show_num').html(html);
      }
      function startCheckNum(obj){
          ID_setInterval=setInterval(function(){
              checkNum(obj);
          },250);
      }
      function endCheckNum(){
          clearInterval(ID_setInterval);
      }
      
      $(".open-popup-link").click(function(){
    	  var even = $(this).attr('data-even');
    	  if(even == 'jianyi'){
    		  $(".open-popup-link").parents('.quick_send_box').find("#weibo_title").html('欢迎给我们提建议');
    		  $(".open-popup-link").parents('.quick_send_box').find('#weibo_content').val('#建议#');
    	  }else{
    		  $(".open-popup-link").parents('.quick_send_box').find("#weibo_title").html('给我们反馈系统错误');
    		  $(".open-popup-link").parents('.quick_send_box').find('#weibo_content').val('#bug#');
    	  }
    	  
      })
  </script>
</div>
</if>