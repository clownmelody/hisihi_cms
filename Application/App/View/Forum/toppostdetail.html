<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<title>嘿设汇置顶详情</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="Resource-type" content="Document" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">
	<meta http-equiv="Expires" content="0">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Cache-control" content="no-cache">
	<meta http-equiv="Cache" content="no-cache">
	<style>
	*::after, *::before {
	    box-sizing: border-box;
	}
	ul{
		 list-style-type: none;
	}
	*{
		margin: 0;
		padding: 0;
	}
	body{
		background: #ececec;
	}
	img {
		width: 100%;
	}
	.detailed-main{
		padding: 10px;
	}
	.detailed-box{
		border:1px solid #eee;
		margin-bottom: 10px;
		background: #fff;
		box-shadow: 0 0px 1px #ddd;
	}
	.detailed-top{
		padding: 10px;
		border-bottom: 1px solid #ececec;
	}
	.detailed-top-title{
		color: #333;
		font-size: 16px;
		overflow: hidden;
	    text-overflow: ellipsis;
	    white-space: nowrap;
	    line-height: 35px;
	}
	.detailed-time{
		font-size: 12px;
		text-align: right;
		color: #9AA09E;
	}
	.detailed-body{
		padding: 10px;
	}
	.detailed-txt{
		/*font-size: 14px;*/
		/*color: #8E8A87;*/
	}
	.review-top{
		border-bottom: 1px solid #676767;
	}
	.detailed-item-img{
		width: 50px;
		height: 50px;
		border-radius: 50%;
		overflow: hidden;
		background: #999;
		/*display: inline-block;*/
		margin-right: 10px;
		float: left;
	}
	.detailed-item-body{
		/*display: inline-block;*/
		padding-left: 60px;

	}
	.detailed-item-name{
		color: #6A6A68;
		font-size: 14px;
		overflow: hidden;
	    text-overflow: ellipsis;
	    white-space: nowrap;
	    line-height: 30px;
	}
	.detailed-item-time{
		font-size: 12px;
		color: #A4A4A4;
		overflow: hidden;
	    text-overflow: ellipsis;
	    white-space: nowrap;
	    margin-bottom: 10px;
	}
	.detailed-item-txt{
		font-size: 14px;
		color: #9C9A9D;
	}
	.detailed-list >li{
		padding: 10px 0;
		border-bottom: 1px solid #D9D9D9;
	}
	.detailed-list >li:nth-last-child(1){
		border-bottom: 0 solid #D9D9D9;
	}
	.line-icon{
		border: 1px solid #2C3949;
		color: #2C3949;
		padding: 1px 5px;
		border-radius: 2px;
		margin-right: 5px;
		font-size: 14px;
	}
	.box-btn{
		text-align: center;
		text-decoration: none;
		display: block;
		padding:  10px;
		color: #9C9A9D;
	}
	.box-btn:hover{
		text-decoration: none;
		color: #9C9A9D;
		background: #f1f1f1;
	}
	</style>
</head>
<body>
	
	<div class="detailed-main">
		<div class="detailed-box">
			<input type="hidden" id="postid" value="{$post.post_id}">
			<input type="hidden" id="replyTotalCount" value="{$replyTotalCount}">
			<div class="detailed-top">
				<p class="detailed-top-title">
					<span class="line-icon">{$post.type}</span>
					{$post.title}
				</p>
				<p class="detailed-time">{$post.create_time|date='m-d H:i',###}</p>
			</div>
			<!-- /.detailed-top -->
			
			<div class="detailed-body">
				<p class="detailed-txt">
					{$post.content}
				</p>
			</div>
			<!-- /.detailed-body -->

		</div>
		<!-- /.detailed-box -->

		<if condition="$isShowReply==1 ">
			<div class="detailed-box detailed-body">
					<p class="detailed-top-title review-top">
						评论
					</p>
					<ul class="detailed-list">
						<volist name="replyList" id="reply">
							<li>
								<img src="{$reply.userInfo.avatar128}" alt="" class="detailed-item-img">
								<div class="detailed-item-body">
									<p class="detailed-item-name">{$reply.userInfo.nickname}</p>
									<p class="detailed-item-time">{$reply.create_time|date='m-d H:i',###}</p>
									<p class="detailed-item-txt">
										{$reply.content}
									</p>
								</div>
							</li>
						</volist>
					</ul>
			</div>
		</if>
		<!-- /.detailed-box -->

		<div class="detailed-box">
			<a href="javascript:void(0);" class="box-btn" onclick="getMoreReplay();">点击加载更多</a>
		</div>

	</div>
	<script type="text/javascript" src="__STATIC__/zepto.min.js"></script>
	<script>
		var page = 2;
		var server_url = '{$Think.server.HTTP_HOST}';
		function getMoreReplay(){
			var postid = $('#postid').val();
			$.ajax({
				type: 'GET',
				url: 'http://' + server_url + '/api.php?s=/forum/ajaxPostReplyList/post_id/' + postid +'/page/' + page,
				dataType: 'json',
				success: function(data){
					console.log(data);
					if(data['error_code'] == 0 && data != null){
						var replay = data['data'];
						var replayarray = [];
						for(var i in replay){
							var userInfo = replay[i]['userInfo'];
							replayarray.push('<li>');
							replayarray.push('<img src="' + userInfo['avatar128'] +'" alt="" class="detailed-item-img">');
							replayarray.push('<div class="detailed-item-body">');
							replayarray.push('<p class="detailed-item-name">' + userInfo['nickname'] +'</p>');
							replayarray.push('<p class="detailed-item-time">' + dateParse(replay[i]['create_time']) +'</p>');
							replayarray.push('<p class="detailed-item-txt">' + replay[i]['content'] +'</p>');
							replayarray.push('</div></li>');
						}
						$('ul.detailed-list').append(replayarray.join(''));
						page += 1;
					}
				},
				error: function(xhr, type){
					alert('获取评论失败!')
				}
			})
		}
		function dateParse(date){
			var newDate = new Date(parseInt(date) * 1000).Format('MM-dd hh:mm');
			return newDate;
		}

		Date.prototype.Format = function (fmt) { //author: meizz
			var o = {
				"M+": this.getMonth() + 1, //月份
				"d+": this.getDate(), //日
				"h+": this.getHours(), //小时
				"m+": this.getMinutes(), //分
				"s+": this.getSeconds(), //秒
				"q+": Math.floor((this.getMonth() + 3) / 3), //季度
				"S": this.getMilliseconds() //毫秒
			};
			if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
			for (var k in o)
				if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
			return fmt;
		}
	</script>
</body>
</html>
